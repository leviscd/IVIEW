<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iView - IPTV Live</title>
    <!-- Inclui Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Hls.js para reprodução fluida de m3u8 -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* Variáveis de Cores e Estilo */
        :root {
            --dark-bg: #121212;
            --main-bg: #1c1c1c;
            --highlight-color: #9333ea; /* Violeta principal */
            --focus-bg: #5a2484; /* Fundo do item selecionado/focado */
            --text-light: #e0e0e0;
            --text-dark: #a0a0a0;
        }

        /* Configuração do Tailwind */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': 'var(--dark-bg)',
                        'secondary-dark': 'var(--main-bg)',
                        'accent-violet': 'var(--highlight-color)',
                        'focus-bg': 'var(--focus-bg)',
                        'text-light': 'var(--text-light)',
                        'text-dark': 'var(--text-dark)',
                    },
                }
            }
        }

        /* Estilos Globais */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #000000;
            color: var(--text-light);
            min-height: 100vh;
            /* Fix para mobile address bar */
            min-height: 100dvh; 
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 0;
        }

        /* Container Principal */
        .iptv-container {
            width: 95%;
            max-width: 1400px;
            height: 90vh; /* Fallback */
            height: 90dvh; 
            min-height: 500px;
            background-color: var(--main-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 50px rgba(147, 51, 234, 0.6);
            display: flex;
            gap: 20px;
            transition: all 0.5s ease-in-out;
            position: relative;
        }

        /* Foco e Seleção */
        .category-item.focus,
        .channel-item.focus {
            outline: none;
            background-color: var(--focus-bg) !important;
            color: white;
            transform: scale(1.02); /* Reduzido levemente para mobile não quebrar layout */
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.9);
            border: 1px solid var(--highlight-color);
        }

        /* --- MODO FULL SCREEN (CSS + Native Handling) --- */
        /* Quando a classe .full-player-mode é ativada ou quando estamos em fullscreen nativo */
        .iptv-container.full-player-mode,
        :fullscreen .iptv-container,
        :-webkit-full-screen .iptv-container {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            border-radius: 0;
            padding: 0;
            box-shadow: none;
            background-color: black;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
            max-width: none;
        }

        .iptv-container.full-player-mode .sidebar,
        .iptv-container.full-player-mode .channel-list-wrapper {
            display: none !important;
        }

        .iptv-container.full-player-mode .main-content {
            width: 100%;
            height: 100%;
            padding: 0;
        }
        
        .iptv-container.full-player-mode .video-player {
            border-radius: 0;
            border: none;
            width: 100%;
            height: 100%;
        }

        /* Sidebar */
        .sidebar {
            width: 180px;
            flex-shrink: 0;
            padding-right: 15px;
            border-right: 1px solid var(--dark-bg);
            display: flex;
            flex-direction: column;
            gap: 5px;
            max-height: 100%;
            overflow-y: auto;
        }
        .sidebar::-webkit-scrollbar, .channel-list::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-thumb, .channel-list::-webkit-scrollbar-thumb { background-color: var(--focus-bg); border-radius: 3px; }

        .logo { margin-bottom: 25px; padding-left: 10px; }
        .logo i { font-size: 30px; color: var(--highlight-color); margin-right: 8px; }
        .logo h1 { font-size: 24px; font-weight: 700; margin: 0; }

        .category-item {
            padding: 12px 10px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .category-item.selected {
            background-color: rgba(147, 51, 234, 0.2);
            color: var(--text-light);
        }

        /* Lista de Canais */
        .channel-list-wrapper {
            width: 280px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--dark-bg);
            padding-right: 15px;
        }

        .channel-list {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 100%;
        }

        .channel-item {
            display: flex;
            align-items: center;
            padding: 10px 8px;
            margin-bottom: 5px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .channel-number {
            font-size: 14px;
            font-weight: 700;
            color: var(--dark-bg);
            background-color: var(--highlight-color);
            padding: 3px 7px;
            border-radius: 3px;
            margin-right: 10px;
            min-width: 35px;
            text-align: center;
        }

        /* Player Area */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .video-player {
            flex-grow: 1;
            background-color: #000;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--dark-bg);
            transition: all 0.5s ease-in-out;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        
        .video-wrapper, .video-wrapper video {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Ajuste para ver tudo ou 'cover' para preencher */
            background: black;
            display: block;
        }

        /* Overlay */
        .player-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 15px 20px;
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            z-index: 25;
        }
        
        /* Mostra controles no hover, foco ou mobile touch */
        .video-player:hover .player-overlay,
        .video-player.player-controls-visible .player-overlay,
        .video-player.focus .player-overlay {
            opacity: 1;
        }
        
        .control-button {
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
            padding: 10px; /* Aumenta área de toque */
        }
        .control-button.focus {
            color: var(--highlight-color);
            transform: scale(1.2);
        }

        /* UI Elements */
        .channel-info-player {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            z-index: 20;
            pointer-events: none;
        }

        .ping-indicator {
            position: absolute;
            top: 60px;
            right: 20px;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: rgba(0,0,0,0.8);
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 30;
            display: none;
            pointer-events: none;
        }
        .ping-indicator.active { display: block; }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border-left-color: var(--highlight-color);
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- RESPONSIVIDADE AVANÇADA --- */

        /* Tablet e Mobile (Modo Retrato) */
        @media (max-width: 1024px) {
            .iptv-container {
                flex-direction: column;
                height: 100dvh; /* Ocupa toda a altura */
                width: 100%;
                padding: 0;
                border-radius: 0;
            }

            /* No mobile, o player fica no topo */
            .main-content {
                order: 1; /* Player primeiro */
                flex-grow: 0;
                height: 40dvh; /* Altura fixa para o player */
                width: 100%;
            }

            .video-player {
                border-radius: 0;
                border-left: none;
                border-right: none;
                border-top: none;
            }

            /* As colunas de navegação ficam embaixo */
            .sidebar {
                order: 2;
                width: 100%;
                height: 60px; /* Menu horizontal compacto */
                flex-direction: row;
                border-right: none;
                border-bottom: 1px solid var(--dark-bg);
                padding: 5px;
                overflow-x: auto;
                overflow-y: hidden;
                white-space: nowrap;
                align-items: center;
            }
            
            .logo { display: none; } /* Esconde logo no mobile para salvar espaço */

            .category-item {
                padding: 8px 15px;
                margin-right: 5px;
                font-size: 13px;
            }

            .channel-list-wrapper {
                order: 3;
                width: 100%;
                flex-grow: 1; /* Ocupa o resto do espaço */
                border-right: none;
                padding: 10px;
                overflow-y: auto;
            }

            /* Ajustes de texto para telas pequenas */
            .channel-info-player {
                font-size: 11px;
                padding: 4px 8px;
                top: 10px;
                right: 10px;
            }
            .ping-indicator {
                top: 45px;
                right: 10px;
            }
        }

        /* Mobile Pequeno (Phones) */
        @media (max-width: 640px) {
            .main-content {
                height: 35dvh; /* Player um pouco menor em telefones */
            }
            .channel-item {
                padding: 12px 10px; /* Touch targets maiores */
            }
        }

        /* Landscape em Mobile (Girar tela) */
        @media (max-height: 500px) and (orientation: landscape) {
            .iptv-container:not(.full-player-mode) {
                flex-direction: row;
            }
            .sidebar { width: 120px; display: none; } /* Esconde sidebar em landscape pequeno se não for fullscreen */
            .channel-list-wrapper { width: 200px; }
            .main-content { height: 100%; }
        }
    </style>
</head>
<body>

    <div class="iptv-container" id="iptv-container">
        
        <!-- SIDEBAR (Navegação) -->
        <div class="sidebar" data-section="categories">
            <div class="logo">
                <i class="fas fa-eye"></i>
                <h1>iView</h1>
            </div>

            <div class="category-item focus" data-category="ESPORTES">ESPORTES</div> 
            <div class="category-item" data-category="FILMES">FILMES</div>
            <div class="category-item" data-category="SÉRIES">SÉRIES</div>
            <div class="category-item" data-category="AO VIVO">AO VIVO</div>
            <div class="category-item" data-category="NOTÍCIAS">NOTÍCIAS</div>
            <div class="category-item" data-category="DOCUMENTÁRIOS">DOCS</div>
            <div class="category-item" data-category="INFANTIL">KIDS</div>
            <div class="category-item" data-category="CONFIGURAÇÕES">CONFIG</div>
        </div>

        <!-- CONTEÚDO -->
        <div class="main-content">
            <!-- PLAYER (Movido para cima do código para facilitar ordem visual no mobile via CSS order) -->
            <div class="video-player" data-section="player" id="video-player-container">
                <div class="video-wrapper">
                    <!-- Video Element -->
                    <video id="iptv-video" autoplay muted playsinline x-webkit-airplay="allow"></video>
                </div>
                
                <!-- Info Topo -->
                <div class="channel-info-player" id="player-info-display">
                    <i class="fas fa-satellite-dish text-red-500 mr-2 animate-pulse"></i>
                    <span id="player-channel-text">AGUARDANDO SELEÇÃO</span>
                </div>

                <!-- Ping -->
                <div class="ping-indicator" id="ping-display">Potência do Sinal: --ms</div>

                <!-- Controles Overlay -->
                <div class="player-overlay">
                    <div class="text-left">
                        <div class="text-lg font-bold text-white" id="overlay-channel-name">--</div>
                        <div class="text-xs text-accent-violet uppercase">Ao Vivo • HD</div>
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <i class="fas fa-volume-up control-button text-2xl" data-control="volume" id="volume-btn"></i>
                        <i class="fas fa-expand control-button text-2xl" data-control="fullscreen" id="fullscreen-btn"></i>
                    </div>
                </div>

                <!-- Loading -->
                <div class="absolute inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center z-10 hidden" id="player-loading-screen">
                    <div class="loading-spinner"></div>
                    <div class="text-lg font-semibold text-white text-center">Sintonizando...</div>
                    <div class="text-xs text-gray-400 mt-2">Estabilizando conexão</div>
                </div>
                
                <!-- Erro -->
                <div class="absolute inset-0 bg-black bg-opacity-95 flex flex-col items-center justify-center z-10 hidden" id="player-error-screen">
                    <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-3"></i>
                    <div class="text-lg text-white">Sinal Indisponível</div>
                    <div class="text-sm text-gray-500 mt-2">Tente outro canal</div>
                </div>
            </div>
        </div>
        
        <!-- LISTA DE CANAIS (Fica na direita no desktop, embaixo no mobile) -->
        <div class="channel-list-wrapper">
            <div class="channel-list" data-section="channels" id="channel-list">
                <!-- JS Preenche -->
            </div>
        </div>

    </div>

    <script>
        // --- DADOS ---
        const MOCK_CHANNELS = {
            "ESPORTES": [
                { num: 101, name: "PREMIERE CLUBES", url: "https://d1muf25xa11so8hp23.s27-usa-cloudfront-net.online/token/60f73ef0f9ad2fc60e7894739a496ba7/premiere.m3u8" },
                { num: 102, name: "ESPN BRASIL", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" },
                { num: 103, name: "SPORTV", url: "" },
                { num: 104, name: "COMBATE", url: "" },
            ],
            "FILMES": [
                { num: 201, name: "HBO", url: "" },
                { num: 202, name: "TELECINE", url: "" },
            ],
            "SÉRIES": [
                { num: 301, name: "WARNER", url: "" },
            ],
            "AO VIVO": [
                { num: 401, name: "GLOBO", url: "" },
                { num: 402, name: "CNN", url: "" },
            ],
            "NOTÍCIAS": [
                { num: 501, name: "NEWS GLOBAL", url: "" },
            ],
            "DOCUMENTÁRIOS": [
                { num: 601, name: "DISCOVERY", url: "" },
            ],
            "INFANTIL": [
                { num: 701, name: "CARTOON", url: "" },
            ],
            "CONFIGURAÇÕES": [
                { num: 901, name: "TESTE DE REDE", url: "" },
            ]
        };

        const elements = {
            container: document.getElementById('iptv-container'),
            channelListContainer: document.getElementById('channel-list'),
            videoPlayer: document.getElementById('iptv-video'),
            playerContainer: document.getElementById('video-player-container'),
            playerChannelText: document.getElementById('player-channel-text'),
            overlayChannelName: document.getElementById('overlay-channel-name'),
            loadingScreen: document.getElementById('player-loading-screen'),
            errorScreen: document.getElementById('player-error-screen'),
            pingDisplay: document.getElementById('ping-display'),
            categories: [], 
            channels: [], 
        };

        let currentSection = 'categories';
        let focusedIndex = 0;
        let isFullPlayerMode = false;
        let pingInterval = null;
        let hls = null; 

        // --- MODO TELA CHEIA INTELIGENTE ---

        async function toggleFullPlayerMode(enable) {
            isFullPlayerMode = enable;
            
            if (enable) {
                // 1. Adiciona a classe CSS para garantir que o div ocupe 100%
                elements.container.classList.add('full-player-mode');
                setCurrentSection('player');

                // 2. Tenta ativar o Fullscreen Nativo no Container Principal
                try {
                    const elem = elements.container;
                    if (elem.requestFullscreen) {
                        await elem.requestFullscreen();
                    } else if (elem.webkitRequestFullscreen) { /* Safari */
                        await elem.webkitRequestFullscreen();
                    } else if (elem.msRequestFullscreen) { /* IE11 */
                        await elem.msRequestFullscreen();
                    }
                    
                    // 3. Tenta travar a orientação em Paisagem (Android/Chrome)
                    if (screen.orientation && screen.orientation.lock) {
                        try {
                            await screen.orientation.lock('landscape');
                        } catch (e) {
                            console.log('Bloqueio de orientação não suportado ou permitido:', e);
                        }
                    }
                } catch (err) {
                    console.log("Erro ao entrar em fullscreen nativo:", err);
                }

            } else {
                // Sair do modo fullscreen
                elements.container.classList.remove('full-player-mode');
                
                if (document.fullscreenElement) {
                    try {
                        if (document.exitFullscreen) document.exitFullscreen();
                        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                    } catch(e) { console.log(e); }
                }
                
                // Destravar orientação
                if (screen.orientation && screen.orientation.unlock) {
                    try { screen.orientation.unlock(); } catch(e){}
                }

                setTimeout(() => {
                    setCurrentSection('channels');
                    updateFocus();
                }, 200);
            }
        }

        // Listener para detectar se o usuário saiu do fullscreen nativo pelo botão "Esc" ou gesto do celular
        document.addEventListener('fullscreenchange', checkFullscreenState);
        document.addEventListener('webkitfullscreenchange', checkFullscreenState);

        function checkFullscreenState() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                // Se o navegador saiu do fullscreen, garante que nossa UI saia também
                if (isFullPlayerMode) {
                    toggleFullPlayerMode(false);
                }
            }
        }
        
        function setCurrentSection(section) {
            if (currentSection !== section) {
                currentSection = section;
                focusedIndex = 0; 
                updateFocus(); 
            }
        }

        function renderChannels(categoryName) {
            const channels = MOCK_CHANNELS[categoryName] || [];
            elements.channelListContainer.innerHTML = '';
            elements.channels = [];
            
            if (categoryName === 'CONFIGURAÇÕES') {
                 elements.channelListContainer.innerHTML = `<div class="p-4 text-center text-accent-violet font-semibold text-sm">iView v2.2<br>Mobile Optimized</div>`;
            } else if (channels.length === 0) {
                elements.channelListContainer.innerHTML = `<div class="p-4 text-center text-text-dark text-sm">Sem sinal.</div>`;
                return;
            }

            channels.forEach((channel, index) => {
                const item = document.createElement('div');
                item.className = 'channel-item transition duration-200';
                item.setAttribute('data-channel-index', index);
                item.setAttribute('data-channel-url', channel.url);
                item.setAttribute('data-channel-num', channel.num);
                item.innerHTML = `<span class="channel-number">${channel.num}</span><span class="channel-name truncate flex-1">${channel.name}</span>`;
                
                item.addEventListener('click', () => {
                    selectChannel(channel); 
                    // No mobile, clicar no canal já pode sugerir fullscreen, mas mantemos opcional para o usuário clicar no botão
                    if (window.innerWidth <= 768) {
                        // Opção: toggleFullPlayerMode(true); // Descomente para auto-fullscreen no mobile
                    }
                });
                
                elements.channelListContainer.appendChild(item);
                elements.channels.push(item);
            });
        }
        
        // --- LOGIC & PLAYER ---

        function startPingSimulation() {
            if (pingInterval) clearInterval(pingInterval);
            elements.pingDisplay.classList.add('active');
            pingInterval = setInterval(() => {
                const ms = Math.floor(Math.random() * (85 - 15 + 1) + 15);
                const color = ms > 60 ? '#ffcc00' : '#00ff00';
                elements.pingDisplay.style.color = color;
                elements.pingDisplay.textContent = `Sinal: ${ms}ms`;
            }, 1000);
        }

        function stopPingSimulation() {
            if (pingInterval) {
                clearInterval(pingInterval);
                pingInterval = null;
            }
            elements.pingDisplay.classList.remove('active');
        }

        function selectChannel(channelData) {
            const { num, name, url } = channelData;

            if (elements.overlayChannelName.textContent === name && !elements.videoPlayer.paused && elements.errorScreen.classList.contains('hidden')) {
                return; 
            }

            elements.playerChannelText.textContent = `${num} ${name}`;
            elements.overlayChannelName.textContent = name;
            elements.errorScreen.classList.add('hidden');
            elements.loadingScreen.classList.remove('hidden');
            
            startPingSimulation();

            if (!url) {
                destroyHls();
                showError();
                return;
            }
            loadStream(url);
        }

        function loadStream(url) {
            const video = elements.videoPlayer;

            video.onplaying = () => {
                elements.loadingScreen.classList.add('hidden');
                stopPingSimulation();
            };
            
            video.onerror = () => {
                if(video.src) showError();
            };

            if (Hls.isSupported()) {
                destroyHls(); 
                hls = new Hls({ enableWorker: true, lowLatencyMode: true });
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play().catch(() => console.log("Autoplay aguardando user."));
                });
                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                hls.recoverMediaError();
                                break;
                            default:
                                destroyHls();
                                showError();
                                break;
                        }
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                destroyHls();
                video.src = url;
                video.addEventListener('loadedmetadata', function() {
                    video.play().catch(() => console.log("Autoplay aguardando user."));
                });
            } else {
                showError();
            }
        }

        function destroyHls() {
            if (hls) {
                hls.destroy();
                hls = null;
            }
        }

        function showError() {
            stopPingSimulation();
            elements.loadingScreen.classList.add('hidden');
            elements.errorScreen.classList.remove('hidden');
        }

        // --- INPUT HANDLING ---

        function updateFocus() {
            document.querySelectorAll('.focus').forEach(el => el.classList.remove('focus'));
            
            let elementsToFocus = [];
            let focusedElement = null;

            if (currentSection === 'categories') elementsToFocus = elements.categories;
            else if (currentSection === 'channels') elementsToFocus = elements.channels;
            else if (currentSection === 'player') {
                elements.playerContainer.classList.add('focus');
                elements.playerContainer.classList.add('player-controls-visible');
                return;
            }
            
            elements.playerContainer.classList.remove('focus');
            elements.playerContainer.classList.remove('player-controls-visible');

            if (elementsToFocus.length > 0) {
                focusedIndex = Math.max(0, Math.min(focusedIndex, elementsToFocus.length - 1));
                focusedElement = elementsToFocus[focusedIndex];
                
                if (focusedElement) {
                    focusedElement.classList.add('focus');
                    focusedElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
                    
                    if (currentSection === 'categories') {
                        const categoryName = focusedElement.getAttribute('data-category');
                        renderChannels(categoryName);
                    }
                }
            }
        }

        // Teclado (TV/Desktop)
        document.addEventListener('keydown', (e) => {
            const isCategorySection = currentSection === 'categories';
            const isChannelSection = currentSection === 'channels';
            
            if (isFullPlayerMode) {
                if (e.key === 'Escape' || e.key === 'Backspace') {
                    e.preventDefault();
                    toggleFullPlayerMode(false);
                }
                if (e.key === 'Enter') elements.videoPlayer.muted = !elements.videoPlayer.muted;
                return;
            }

            let handled = true;

            switch (e.key) {
                case 'ArrowUp':
                    focusedIndex = Math.max(0, focusedIndex - 1);
                    break;
                case 'ArrowDown':
                    const maxIndex = isCategorySection ? elements.categories.length - 1 : elements.channels.length - 1;
                    focusedIndex = Math.min(maxIndex, focusedIndex + 1);
                    break;
                case 'ArrowLeft':
                    if (isChannelSection) {
                        if (window.innerWidth <= 1024) { /* Mobile: Sobe para player ou menu lateral? */ }
                        else setCurrentSection('categories');
                    } else if (currentSection === 'player') setCurrentSection('channels');
                    else handled = false;
                    break;
                case 'ArrowRight':
                    if (isCategorySection && elements.channels.length > 0) setCurrentSection('channels');
                    else if (isChannelSection) setCurrentSection('player');
                    else handled = false;
                    break;
                case 'Enter':
                    if (isChannelSection && elements.channels[focusedIndex]) {
                        const el = elements.channels[focusedIndex];
                        const data = {
                            num: el.getAttribute('data-channel-num'),
                            name: el.querySelector('.channel-name').textContent,
                            url: el.getAttribute('data-channel-url'),
                        };
                        selectChannel(data);
                        toggleFullPlayerMode(true);
                    } else if (currentSection === 'player') toggleFullPlayerMode(true);
                    else handled = false;
                    break;
                default: handled = false;
            }

            if (handled) { e.preventDefault(); updateFocus(); }
        });

        function init() {
            elements.categories = Array.from(document.querySelectorAll('.category-item'));
            
            // Listeners de Botão
            document.getElementById('fullscreen-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFullPlayerMode(!isFullPlayerMode);
            });
            
            // Double tap/click no player
            elements.playerContainer.addEventListener('dblclick', () => toggleFullPlayerMode(!isFullPlayerMode));

            document.getElementById('volume-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                elements.videoPlayer.muted = !elements.videoPlayer.muted;
                // Feedback visual poderia ser adicionado aqui
            });

            const initialCategoryName = elements.categories[0].getAttribute('data-category');
            renderChannels(initialCategoryName);
            
            const firstChannel = MOCK_CHANNELS["ESPORTES"][0];
            selectChannel(firstChannel);
            
            setCurrentSection('categories');
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
