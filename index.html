<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>iView - IPTV Live</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        :root {
            --dark-bg: #0a0a0a; 
            --main-bg: #121212;
            --sidebar-bg: #0f0f0f;
            --highlight-color: #9333ea;
            --focus-bg: #6b21a8;
            --text-light: #f3f3f3;
            --text-dark: #a3a3a3;
        }

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent-violet': 'var(--highlight-color)',
                    },
                }
            }
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #000;
            color: var(--text-light);
            height: 100vh;
            height: 100dvh; 
            width: 100vw;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Container Padrão */
        .iptv-container {
            width: 100%;
            height: 100%;
            background-color: var(--main-bg);
            display: flex;
            transition: all 0.3s ease-in-out;
            position: relative;
        }

        /* Foco e Seleção */
        .category-item.focus,
        .channel-item.focus {
            outline: none;
            background-color: var(--focus-bg) !important;
            color: white;
            border-left: 4px solid var(--highlight-color); 
            padding-left: 8px; 
        }

        /* --- MODO FULL SCREEN CORRIGIDO --- */
        /* Adicionado position fixed e dimensões forçadas para garantir tela cheia real visualmente */
        .iptv-container.full-player-mode,
        :fullscreen .iptv-container,
        :-webkit-full-screen .iptv-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: black !important;
            z-index: 99999 !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .iptv-container.full-player-mode .sidebar,
        .iptv-container.full-player-mode .channel-list-wrapper {
            display: none !important;
        }

        /* Sidebar (Categorias) */
        .sidebar {
            width: 80px; 
            flex-shrink: 0;
            background-color: var(--sidebar-bg);
            border-right: 1px solid #222;
            display: flex;
            flex-direction: column;
            align-items: center; 
            padding-top: 15px;
            gap: 8px;
            overflow-y: auto;
            transition: width 0.3s;
        }
        
        .sidebar::-webkit-scrollbar, .channel-list::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-thumb, .channel-list::-webkit-scrollbar-thumb { background-color: var(--focus-bg); border-radius: 2px; }

        .logo { margin-bottom: 20px; }
        .logo i { font-size: 24px; color: var(--highlight-color); }
        .logo h1 { display: none; } 

        .category-item {
            width: 90%;
            padding: 12px 0;
            cursor: pointer;
            border-radius: 8px;
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 10px;
            text-align: center;
            border-left: 4px solid transparent; 
        }
        .category-item i { font-size: 18px; margin-bottom: 4px; }
        .category-item.selected, .category-item:hover {
            background-color: rgba(147, 51, 234, 0.1);
            color: white;
        }
        .category-item.selected i { color: var(--highlight-color); }

        /* Lista de Canais */
        .channel-list-wrapper {
            width: 300px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            background-color: #151515;
            border-right: 1px solid #222;
        }

        .channel-list-header {
            padding: 20px 15px;
            font-size: 18px;
            font-weight: 700;
            color: white;
            border-bottom: 1px solid #222;
        }

        .channel-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .channel-item {
            display: flex;
            align-items: center;
            padding: 12px 10px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            border-left: 4px solid transparent;
        }
        .channel-item:hover { background-color: #222; }

        .channel-number {
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            background-color: #333;
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 12px;
            min-width: 30px;
            text-align: center;
        }
        
        .channel-item.playing .channel-number {
            background-color: var(--highlight-color);
            color: white;
        }
        .channel-item.playing {
            background-color: rgba(147, 51, 234, 0.1);
        }

        /* Player Area */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #000;
            position: relative;
        }
        
        .video-player {
            width: 100%;
            height: 100%;
            background-color: #000;
            position: relative;
            overflow: hidden;
        }
        
        .video-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: black;
        }

        .video-wrapper video {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Garante que nada é cortado */
            display: block;
        }
        
        /* No modo Fullscreen, usamos contain para garantir que o vídeo inteiro apareça sem cortes */
        .iptv-container.full-player-mode .video-wrapper video {
            object-fit: contain !important; 
        }

        /* Overlays */
        .overlay-element {
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none; 
        }
        .overlay-element.visible { opacity: 1; pointer-events: auto; }

        .player-overlay {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.95));
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            z-index: 25;
        }
        
        .channel-info-player {
            position: absolute;
            top: 20px; right: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            z-index: 20;
            backdrop-filter: blur(4px);
        }

        .ping-indicator {
            position: absolute;
            top: 60px; right: 20px;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: rgba(0,0,0,0.6);
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 30;
            display: none;
        }
        .ping-indicator.active { display: block; }

        .control-button {
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
            padding: 10px;
        }
        .control-button:hover { color: var(--highlight-color); transform: scale(1.1); }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            width: 40px; height: 40px;
            border-radius: 50%;
            border-left-color: var(--highlight-color);
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responsividade */
        @media (max-width: 1024px) {
            .iptv-container { flex-direction: column; }
            .sidebar {
                width: 100%; height: auto; min-height: 60px;
                flex-direction: row; border-right: none; border-bottom: 1px solid #222;
                padding: 0 10px; overflow-x: auto;
            }
            .category-item { min-width: 60px; width: auto; padding: 8px; border-left: none; border-bottom: 3px solid transparent; border-radius: 0;}
            .category-item.focus { border-left: none; border-bottom: 3px solid var(--highlight-color); background: transparent !important;}
            
            .main-content { order: 1; height: 35vh; height: 35dvh; }
            .sidebar { order: 2; }
            .channel-list-wrapper { order: 3; width: 100%; height: auto; flex-grow: 1; }
            .channel-list-header { display: none; }
        }

        @media (max-height: 500px) and (orientation: landscape) {
            .iptv-container:not(.full-player-mode) { flex-direction: row; }
            .sidebar { width: 60px; flex-direction: column; padding-top: 10px; height: 100%; border-bottom: none; border-right: 1px solid #222;}
            .category-item { width: 90%; border-bottom: none; border-left: 3px solid transparent; }
            .main-content { height: 100%; }
            .channel-list-wrapper { width: 220px; }
        }
    </style>
</head>
<body>

    <div class="iptv-container" id="iptv-container">
        
        <!-- SIDEBAR -->
        <div class="sidebar" data-section="categories">
            <div class="logo">
                <i class="fas fa-play-circle"></i>
            </div>

            <div class="category-item focus" data-category="ESPORTES"><i class="fas fa-futbol"></i><span>ESPORTES</span></div> 
            <div class="category-item" data-category="FILMES"><i class="fas fa-film"></i><span>FILMES</span></div>
            <div class="category-item" data-category="SÉRIES"><i class="fas fa-tv"></i><span>SÉRIES</span></div>
            <div class="category-item" data-category="AO VIVO"><i class="fas fa-broadcast-tower"></i><span>TV</span></div>
            <div class="category-item" data-category="NOTÍCIAS"><i class="fas fa-newspaper"></i><span>NEWS</span></div>
            <div class="category-item" data-category="DOCUMENTÁRIOS"><i class="fas fa-globe-americas"></i><span>DOCS</span></div>
            <div class="category-item" data-category="INFANTIL"><i class="fas fa-child"></i><span>KIDS</span></div>
            <div class="category-item" data-category="CONFIGURAÇÕES"><i class="fas fa-cog"></i><span>CONFIG</span></div>
        </div>

        <!-- LISTA DE CANAIS -->
        <div class="channel-list-wrapper">
            <div class="channel-list-header" id="category-title">ESPORTES</div>
            <div class="channel-list" data-section="channels" id="channel-list">
                <!-- JS Preenche -->
            </div>
        </div>

        <!-- PLAYER -->
        <div class="main-content">
            <div class="video-player" data-section="player" id="video-player-container">
                <div class="video-wrapper">
                    <video id="iptv-video" autoplay playsinline x-webkit-airplay="allow"></video>
                </div>
                
                <!-- OVERLAY GROUP -->
                <div id="ui-overlay-group">
                    <div class="channel-info-player overlay-element" id="player-info-display">
                        <i class="fas fa-circle text-red-500 text-[10px] mr-2 animate-pulse"></i>
                        <span id="player-channel-text">SELECIONE UM CANAL</span>
                    </div>

                    <div class="ping-indicator overlay-element" id="ping-display">Sinal: --ms</div>

                    <div class="player-overlay overlay-element">
                        <div class="text-left">
                            <div class="text-2xl font-bold text-white" id="overlay-channel-name">--</div>
                            <div class="text-xs text-accent-violet uppercase font-bold tracking-widest mt-1">Ao Vivo • HD • HLS</div>
                        </div>
                        
                        <div class="flex items-center gap-6">
                            <i class="fas fa-volume-up control-button text-2xl" data-control="volume" id="volume-btn"></i>
                            <i class="fas fa-expand control-button text-2xl" data-control="fullscreen" id="fullscreen-btn"></i>
                        </div>
                    </div>
                </div>

                <!-- LOADING -->
                <div class="absolute inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center z-10 hidden" id="player-loading-screen">
                    <div class="loading-spinner"></div>
                    <div class="text-lg font-semibold text-white text-center">Sintonizando...</div>
                    <div class="text-xs text-gray-400 mt-2">Otimizando buffer</div>
                </div>
                
                <!-- ERROR -->
                <div class="absolute inset-0 bg-black bg-opacity-95 flex flex-col items-center justify-center z-10 hidden" id="player-error-screen">
                    <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-3"></i>
                    <div class="text-lg text-white">Sinal Indisponível</div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- DADOS ---
        const MOCK_CHANNELS = {
            "ESPORTES": [
                { num: 101, name: "PREMIERE CLUBES", url: "https://d1muf25xa11so8hp23.s27-usa-cloudfront-net.online/token/60f73ef0f9ad2fc60e7894739a496ba7/premiere.m3u8" },
                { num: 102, name: "ESPN BRASIL", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" },
                { num: 103, name: "SPORTV", url: "" },
                { num: 104, name: "COMBATE", url: "" },
                { num: 105, name: "FOX SPORTS", url: "" },
            ],
            "FILMES": [
                { num: 201, name: "HBO", url: "" },
                { num: 202, name: "TELECINE", url: "" },
                { num: 203, name: "MEGAPIX", url: "" },
            ],
            "SÉRIES": [
                { num: 301, name: "WARNER", url: "" },
                { num: 302, name: "SONY", url: "" },
            ],
            "AO VIVO": [
                { num: 401, name: "GLOBO", url: "" },
                { num: 402, name: "CNN", url: "" },
                { num: 403, name: "SBT", url: "" },
            ],
            "NOTÍCIAS": [
                { num: 501, name: "NEWS GLOBAL", url: "" },
            ],
            "DOCUMENTÁRIOS": [
                { num: 601, name: "DISCOVERY", url: "" },
            ],
            "INFANTIL": [
                { num: 701, name: "CARTOON", url: "" },
            ],
            "CONFIGURAÇÕES": [
                { num: 901, name: "TESTE DE REDE", url: "" },
            ]
        };

        const elements = {
            container: document.getElementById('iptv-container'),
            channelListContainer: document.getElementById('channel-list'),
            categoryTitle: document.getElementById('category-title'),
            videoPlayer: document.getElementById('iptv-video'),
            playerContainer: document.getElementById('video-player-container'),
            playerChannelText: document.getElementById('player-channel-text'),
            overlayChannelName: document.getElementById('overlay-channel-name'),
            loadingScreen: document.getElementById('player-loading-screen'),
            errorScreen: document.getElementById('player-error-screen'),
            pingDisplay: document.getElementById('ping-display'),
            overlayElements: document.querySelectorAll('.overlay-element'),
            categories: [], 
            channels: [], 
        };

        let currentSection = 'categories';
        let currentCategoryName = 'ESPORTES';
        let focusedIndex = 0;
        let activeChannelIndex = 0; 
        let isFullPlayerMode = false;
        let pingInterval = null;
        let hls = null; 
        let overlayTimer = null;

        // --- ENGINE & FULLSCREEN ---

        async function toggleFullPlayerMode(enable) {
            isFullPlayerMode = enable;
            
            if (enable) {
                elements.container.classList.add('full-player-mode');
                setCurrentSection('player');

                try {
                    const elem = elements.container;
                    if (elem.requestFullscreen) await elem.requestFullscreen();
                    else if (elem.webkitRequestFullscreen) await elem.webkitRequestFullscreen();
                    else if (elem.msRequestFullscreen) await elem.msRequestFullscreen();
                    
                    if (screen.orientation && screen.orientation.lock) {
                        try { await screen.orientation.lock('landscape'); } catch (e) {}
                    }
                } catch (err) { console.log(err); }
                
                showOverlay();

            } else {
                elements.container.classList.remove('full-player-mode');
                
                if (document.fullscreenElement) {
                    try {
                        if (document.exitFullscreen) document.exitFullscreen();
                        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                    } catch(e) {}
                }
                
                if (screen.orientation && screen.orientation.unlock) {
                    try { screen.orientation.unlock(); } catch(e){}
                }

                setTimeout(() => {
                    // Retorna foco para o canal atual
                    setCurrentSection('channels');
                    focusedIndex = activeChannelIndex;
                    updateFocus();
                }, 200);
            }
        }

        function checkFullscreenState() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (isFullPlayerMode) toggleFullPlayerMode(false);
            }
        }
        document.addEventListener('fullscreenchange', checkFullscreenState);
        document.addEventListener('webkitfullscreenchange', checkFullscreenState);

        // --- OVERLAY ---

        function showOverlay() {
            elements.overlayElements.forEach(el => el.classList.add('visible'));
            resetOverlayTimer();
        }

        function hideOverlay() {
            if (elements.loadingScreen.classList.contains('hidden')) {
                elements.overlayElements.forEach(el => el.classList.remove('visible'));
            }
        }

        function resetOverlayTimer() {
            clearTimeout(overlayTimer);
            overlayTimer = setTimeout(hideOverlay, 3500);
        }

        elements.playerContainer.addEventListener('mousemove', showOverlay);
        elements.playerContainer.addEventListener('click', showOverlay);
        elements.playerContainer.addEventListener('touchstart', showOverlay);
        
        // --- CORE ---

        function setCurrentSection(section) {
            if (currentSection !== section) {
                currentSection = section;
                // Se entrar na lista de canais, focar no canal ativo
                if (section === 'channels') focusedIndex = activeChannelIndex;
                else focusedIndex = 0; 
                updateFocus(); 
            }
        }

        function renderChannels(categoryName) {
            currentCategoryName = categoryName;
            elements.categoryTitle.textContent = categoryName;
            const channels = MOCK_CHANNELS[categoryName] || [];
            elements.channelListContainer.innerHTML = '';
            elements.channels = [];
            
            if (categoryName === 'CONFIGURAÇÕES') {
                 elements.channelListContainer.innerHTML = `<div class="p-8 text-center text-gray-500 text-sm">Versão 4.0 HLS Optimized<br>Hardware Acceleration: ON</div>`;
            } else if (channels.length === 0) {
                elements.channelListContainer.innerHTML = `<div class="p-8 text-center text-gray-500 text-sm">Nenhum canal disponível.</div>`;
                return;
            }

            channels.forEach((channel, index) => {
                const item = document.createElement('div');
                item.className = 'channel-item';
                item.setAttribute('data-channel-index', index);
                item.innerHTML = `<span class="channel-number">${channel.num}</span><span class="channel-name truncate flex-1 text-sm font-medium text-gray-200">${channel.name}</span>`;
                
                item.addEventListener('click', () => {
                    activeChannelIndex = index; // Atualiza índice ativo
                    selectChannel(channel);
                });
                
                elements.channelListContainer.appendChild(item);
                elements.channels.push(item);
            });
            
            // Marca o canal visualmente se for o ativo desta categoria
            if (elements.channels[activeChannelIndex]) {
                elements.channels[activeChannelIndex].classList.add('playing');
            }
        }
        
        // --- PLAYBACK ENGINE ---

        function selectChannel(channelData) {
            const { num, name, url } = channelData;

            // Destaque visual na lista
            elements.channels.forEach(el => el.classList.remove('playing'));
            if (elements.channels[activeChannelIndex]) elements.channels[activeChannelIndex].classList.add('playing');

            // LÓGICA CRÍTICA: Se já está tocando
            const currentName = elements.overlayChannelName.textContent;
            if (currentName === name && !elements.videoPlayer.paused && elements.errorScreen.classList.contains('hidden')) {
                // Se clicar no mesmo canal, VAI PARA FULLSCREEN
                toggleFullPlayerMode(true);
                return; 
            }

            // Setup UI
            elements.playerChannelText.textContent = `${num} ${name}`;
            elements.overlayChannelName.textContent = name;
            elements.errorScreen.classList.add('hidden');
            elements.loadingScreen.classList.remove('hidden');
            
            showOverlay();
            startPingSimulation();

            if (!url) {
                destroyHls();
                showError();
                return;
            }
            loadStream(url);
        }

        function changeChannelInFullscreen(direction) {
            const channels = MOCK_CHANNELS[currentCategoryName] || [];
            if (channels.length === 0) return;

            let newIndex = activeChannelIndex + direction;
            
            // Loop da lista
            if (newIndex < 0) newIndex = channels.length - 1;
            if (newIndex >= channels.length) newIndex = 0;

            activeChannelIndex = newIndex;
            selectChannel(channels[activeChannelIndex]);
        }

        function loadStream(url) {
            const video = elements.videoPlayer;

            video.onplaying = () => {
                elements.loadingScreen.classList.add('hidden');
                stopPingSimulation();
                resetOverlayTimer();
            };
            
            video.onerror = () => { if(video.src) showError(); };

            destroyHls(); 

            if (Hls.isSupported()) {
                // CONFIGURAÇÃO DE BAIXA LATÊNCIA E ESTABILIDADE
                hls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90,
                    maxBufferLength: 30, // Aumentado para evitar travadas
                    maxMaxBufferLength: 600,
                    liveSyncDurationCount: 3, // Tenta manter 3 fragmentos atrás do live edge para estabilidade
                });
                
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.muted = false;
                    video.play().catch(() => {
                        video.muted = true;
                        video.play();
                    });
                });
                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR: hls.startLoad(); break;
                            case Hls.ErrorTypes.MEDIA_ERROR: hls.recoverMediaError(); break;
                            default: destroyHls(); showError(); break;
                        }
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
                video.addEventListener('loadedmetadata', function() {
                    video.muted = false;
                    video.play().catch(() => {
                        video.muted = true;
                        video.play();
                    });
                });
            } else {
                showError();
            }
        }

        function destroyHls() {
            if (hls) { hls.destroy(); hls = null; }
        }

        function showError() {
            stopPingSimulation();
            elements.loadingScreen.classList.add('hidden');
            elements.errorScreen.classList.remove('hidden');
        }

        function startPingSimulation() {
            if (pingInterval) clearInterval(pingInterval);
            elements.pingDisplay.classList.add('active');
            pingInterval = setInterval(() => {
                const ms = Math.floor(Math.random() * (45 - 10 + 1) + 10); // Ping melhor simulado
                elements.pingDisplay.style.color = '#00ff00';
                elements.pingDisplay.textContent = `Sinal: ${ms}ms (Estável)`;
            }, 1500);
        }

        function stopPingSimulation() {
            if (pingInterval) { clearInterval(pingInterval); pingInterval = null; }
            elements.pingDisplay.classList.remove('active');
        }

        // --- INPUT HANDLING ---

        function updateFocus() {
            document.querySelectorAll('.focus').forEach(el => el.classList.remove('focus'));
            
            let elementsToFocus = [];
            let focusedElement = null;

            if (currentSection === 'categories') elementsToFocus = elements.categories;
            else if (currentSection === 'channels') elementsToFocus = elements.channels;
            
            if (elementsToFocus.length > 0) {
                focusedIndex = Math.max(0, Math.min(focusedIndex, elementsToFocus.length - 1));
                focusedElement = elementsToFocus[focusedIndex];
                
                if (focusedElement) {
                    focusedElement.classList.add('focus');
                    focusedElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
                    
                    if (currentSection === 'categories') {
                        const categoryName = focusedElement.getAttribute('data-category');
                        renderChannels(categoryName);
                        // Ao navegar categorias com teclado, reseta index do canal
                        activeChannelIndex = 0; 
                    }
                }
            }
        }

        document.addEventListener('keydown', (e) => {
            showOverlay(); 

            // *** LOGICA DE ZAPPING EM FULLSCREEN ***
            if (isFullPlayerMode) {
                if (e.key === 'Escape' || e.key === 'Backspace') {
                    e.preventDefault();
                    toggleFullPlayerMode(false);
                }
                else if (e.key === 'Enter') {
                    // Enter em fullscreen pode abrir info ou mutar
                    // toggleFullPlayerMode(false); // Opcional: sair
                }
                else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    changeChannelInFullscreen(-1); // Canal anterior
                }
                else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    changeChannelInFullscreen(1); // Próximo canal
                }
                return;
            }

            // Logica Normal
            let handled = true;
            const isCategory = currentSection === 'categories';
            const isChannel = currentSection === 'channels';

            switch (e.key) {
                case 'ArrowUp':
                    focusedIndex = Math.max(0, focusedIndex - 1);
                    break;
                case 'ArrowDown':
                    const maxIndex = isCategory ? elements.categories.length - 1 : elements.channels.length - 1;
                    focusedIndex = Math.min(maxIndex, focusedIndex + 1);
                    break;
                case 'ArrowLeft':
                    if (isChannel) {
                        if (window.innerWidth > 1024) setCurrentSection('categories');
                    } 
                    else handled = false;
                    break;
                case 'ArrowRight':
                    if (isCategory && elements.channels.length > 0) setCurrentSection('channels');
                    else handled = false;
                    break;
                case 'Enter':
                    if (isChannel && elements.channels[focusedIndex]) {
                        activeChannelIndex = focusedIndex;
                        const el = elements.channels[focusedIndex];
                        const data = {
                            num: el.getAttribute('data-channel-num'),
                            name: el.querySelector('.channel-name').textContent,
                            url: el.getAttribute('data-channel-url'),
                        };
                        selectChannel(data);
                    } else {
                        // Se estiver na categoria e der enter, vai pra lista
                         if (isCategory && elements.channels.length > 0) setCurrentSection('channels');
                    }
                    break;
                default: handled = false;
            }

            if (handled) { e.preventDefault(); updateFocus(); }
        });

        function init() {
            elements.categories = Array.from(document.querySelectorAll('.category-item'));
            elements.categories.forEach((cat, index) => {
                cat.addEventListener('click', () => {
                    currentSection = 'categories';
                    focusedIndex = index;
                    updateFocus();
                    // Mobile UX: Vai direto pra lista
                    if (window.innerWidth <= 1024) {
                         document.querySelector('.channel-list-wrapper').scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            document.getElementById('fullscreen-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFullPlayerMode(!isFullPlayerMode);
            });
            
            elements.playerContainer.addEventListener('dblclick', () => toggleFullPlayerMode(!isFullPlayerMode));

            document.getElementById('volume-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                elements.videoPlayer.muted = !elements.videoPlayer.muted;
            });

            const initialCategoryName = elements.categories[0].getAttribute('data-category');
            renderChannels(initialCategoryName);
            
            const firstChannel = MOCK_CHANNELS["ESPORTES"][0];
            selectChannel(firstChannel);
            
            setCurrentSection('categories');
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
